/*! dom-to-image 15-09-2015 */
!function(a){"use strict";function b(a,b){for(var c=0;c<a.length;c++){var d=a[c];b.style.setProperty(d,a.getPropertyValue(d),a.getPropertyPriority(d))}}function c(c,d){var e=a.window.getComputedStyle(c);return e.cssText?void(d.style.cssText=e.cssText):void b(e,d)}function d(a){a instanceof SVGElement&&a.setAttribute("xmlns","http://www.w3.org/2000/svg")}function e(a,b){d(a),a instanceof Element&&c(b,a)}function f(a,b,c){function d(a){f(a,function(a){a&&g.appendChild(a),i++,i===h.length&&b(g)},c)}if(c&&!c(a))return void b(null);var g=a.cloneNode(!1);e(g,a);var h=a.childNodes;if(0===h.length)return void b(g);for(var i=0,j=0;j<h.length;j++)d(h[j])}function g(a){var b=a.style;return b.margin=b.marginLeft=b.marginTop=b.marginBottom=b.marginRight="",a}function h(a){return a.replace(/#/g,"%23")}function i(a){return a.setAttribute("xmlns","http://www.w3.org/1999/xhtml"),h((new XMLSerializer).serializeToString(a))}function j(a){return"<foreignObject x='0' y='0' width='100%' height='100%'>"+i(a)+"</foreignObject>"}function k(a,b,c){return"<svg xmlns='http://www.w3.org/2000/svg' width='"+b+"' height='"+c+"'>"+j(a)+"</svg>"}function l(a,b,c){return"data:image/svg+xml;charset=utf-8,"+k(a,b,c)}function m(a,b,c,d){var e=new Image;e.onload=function(){d(e)},e.src=l(g(a),b,c)}function n(a){return t.readAll(document).then(function(a){return a.embedAll(Object.keys(a.rules()))}).then(function(b){var c=document.createElement("div"),d=document.createElement("style");return d.type="text/css",d.appendChild(document.createTextNode(b)),c.appendChild(d),c.appendChild(a),c})}function o(a,b,c){return c=c||{},new Promise(function(d,e){function g(a){b(a),d(a)}f(a,function(b){n(b).then(function(b){m(b,a.scrollWidth,a.scrollHeight,g)})},c.filter)})}function p(a,b){return o(a,function(){},b).then(function(b){var c=document.createElement("canvas");return c.width=a.scrollWidth,c.height=a.scrollHeight,c.getContext("2d").drawImage(b,0,0),c})}function q(a,b,c){return p(a,c).then(function(a){if(a.toBlob)return new Promise(function(c){function d(a){b(a),c(a)}a.toBlob(d)});for(var c=window.atob(a.toDataURL().split(",")[1]),d=new Uint8Array(c.length),e=0;e<c.length;e++)d[e]=c.charCodeAt(e);var f=new Blob([d],{type:"image/png"});return b(f),f})}function r(a,b,c){return p(a,c).then(function(a){return b(a.toDataURL()),a.toDataURL()})}var s={load:function(a){var b=new XMLHttpRequest;return b.open("GET",a,!0),b.responseType="blob",new Promise(function(c,d){b.onload=function(){if(200!==this.status)return void d(new Error('Cannot fetch resource "'+a+'": '+this.status));var e=new FileReader;e.onloadend=function(){c(e.result.split(/,/)[1])},e.readAsDataURL(b.response)},b.send()})}},t=function(){function b(b,c){var d=a.document.implementation.createHTMLDocument(),e=d.createElement("base");d.head.appendChild(e);var f=d.createElement("a");return d.body.appendChild(f),e.href=c,f.href=b,f.href}function c(a,c){var d={},e=a.style.getPropertyValue("src");return e.split(/,\s*/).forEach(function(a){var e=/url\(['"]?([^\?"]+)\??.*?['"]?\)\s+format\(['"]?(.*?)['"]?\)/.exec(a);e&&(d[b(e[1],c)]=e[2])}),d}function d(a,b){if(a.type!==CSSRule.FONT_FACE_RULE)return null;var d=c(a,b);return 0===Object.keys(d).length?null:g({name:function(){return a.style.getPropertyValue("font-family").replace(/"/g,"")},urls:function(){return d},cssText:function(){return a.style.cssText}})}function e(){function a(a){c.push(new Promise(function(b){a.onload=b}))}for(var b=document.querySelectorAll("link[rel=stylesheet]"),c=[],d=0;d<b.length;d++)a(b[d]);return Promise.all(c)}function f(a){return e().then(function(){for(var b=a.styleSheets,c={},e=0;e<b.length;e++)for(var f=b[e].cssRules,g=0;g<f.length;g++){var h=d(f[g],b[e].href);h&&(c[h.data().name()]=h)}return{embedAll:function(a,b){var d=a.map(function(a){return c[a].embed(b||s)});return Promise.all(d).then(function(a){return a.join("\n")})},rules:function(){return c}}})}function g(a){function b(a){function b(a){return a.replace(/([.*+?^${}()|\[\]\/\\])/g,"\\$1")}return new RegExp("url\\(['\"]?"+b(a)+"??.*?['\"]?\\)","g")}function c(a,b){return'url("data:font/'+a+";base64,"+b+'")'}function d(d){return new Promise(function(e,f){var g=a.cssText(),h=[],i=a.urls();Object.keys(i).forEach(function(a){h.push(d.load(a).then(function(d){g=g.replace(b(a),c(i[a],d))})["catch"](function(a){f(a)}))}),Promise.all(h).then(function(){e("@font-face {"+g+"}")})})}return{data:function(){return a},embed:d}}return{readAll:f,impl:{createRule:g,extractUrls:c}}}();a.domtoimage={toImage:o,toDataUrl:r,toBlob:q,impl:{resourceLoader:s,webFontRule:t}}}(this);